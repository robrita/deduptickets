# =============================================================================
# DedupTickets Backend Environment Variables
# Copy this file to .env and update values for your environment
# =============================================================================

# Azure Cosmos DB Configuration
# For local development, use the Cosmos DB Emulator
COSMOS_ENDPOINT=https://localhost:8081
COSMOS_KEY=C2y6yDjf5/R+ob0N8A7Cgv30VRDJIWEHLM+4QDU5DE2nQ9nDuVTqobD4b8mGGyPMbIZnqyMsEcaGQy67XIw/Jw==
COSMOS_DATABASE=deduptickets

# Set to false when using Cosmos DB Emulator (self-signed certificate)
COSMOS_SSL_VERIFY=false

# Set to true to use Microsoft Entra ID (AAD) authentication instead of account key.
# When enabled, COSMOS_KEY is ignored and DefaultAzureCredential is used.
# Requires the "Cosmos DB Built-in Data Contributor" role assigned to your identity.
# See: make assign-cosmos-role ACCOUNT=<name> RG=<resource-group>
COSMOS_USE_AAD=false

# For cloud Cosmos DB with Entra ID, use:
# COSMOS_ENDPOINT=https://<your-account>.documents.azure.com:443/
# COSMOS_USE_AAD=true
# COSMOS_SSL_VERIFY=true

# Azure Resource Identifiers (used by scripts/assign_cosmos_role.sh)
# COSMOS_ACCOUNT=<your-cosmos-account-name>
# AZURE_RESOURCE_GROUP=<your-resource-group>
# AZURE_PRINCIPAL_ID=<your-azure-ad-object-id>  # defaults to signed-in user

# Azure Identity / Service Principal (used by DefaultAzureCredential)
# Required when COSMOS_USE_AAD=true and not using Managed Identity or Azure CLI.
# AZURE_TENANT_ID=<your-azure-ad-tenant-id>
# AZURE_CLIENT_ID=<your-service-principal-app-id>
# AZURE_CLIENT_SECRET=<your-service-principal-secret>

# API Security
# Change this in production!
API_KEY=dev-api-key-change-in-production

# Application Settings
LOG_LEVEL=INFO
DEBUG=true

# Performance Settings
# Request timeout in seconds
REQUEST_TIMEOUT=30

# Azure OpenAI Configuration (required — app will not start without these)
AZURE_OPENAI_ENDPOINT=https://<your-resource>.openai.azure.com/
AZURE_OPENAI_EMBEDDING_DEPLOYMENT=text-embedding-3-small

# Authentication: Entra ID (AAD) by default — no API key needed.
# Set to false to use API key instead.
AZURE_OPENAI_USE_AAD=true
# AZURE_OPENAI_KEY=<your-azure-openai-api-key>  # only when USE_AAD=false

# Cluster-First Dedup Configuration
# Score thresholds for three-tier decision (0.0 - 1.0)
CLUSTER_AUTO_THRESHOLD=0.92
CLUSTER_REVIEW_THRESHOLD=0.85

# Max cluster candidates from vector search
CLUSTER_TOP_K=10

# Filter cluster candidates and explain tickets by customerId (true/false)
DEDUP_FILTER_BY_CUSTOMER=false

# Time window for dedup candidate search (in days)
DEDUP_WINDOW_DAYS=14

# Number of months to search (current + N-1 previous)
CLUSTER_SEARCH_MONTHS=2

# Confidence scoring weights (should sum to 1.0)
DEDUP_WEIGHT_SEMANTIC=0.85
DEDUP_WEIGHT_SUBCATEGORY=0.10
DEDUP_WEIGHT_CATEGORY=0.03
DEDUP_WEIGHT_TIME=0.02

# Proxy / External Ingestion
# When set, load_tickets.py posts to this URL instead of /api/v1/tickets
# PROXY_TICKETS_ENDPOINT=https://your-logic-app.azure.com/workflows/...
